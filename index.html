<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photo Metadata Editor Pro</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/piexifjs@1.0.6/piexif.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#0f0f1e 0%,#1a1a2e 100%);color:#e0e0e0;min-height:100vh;padding-bottom:2rem}header{background:rgba(30,30,50,0.9);backdrop-filter:blur(10px);padding:1.5rem 2rem;border-bottom:1px solid rgba(255,255,255,0.1);box-shadow:0 4px 20px rgba(0,0,0,0.3);position:sticky;top:0;z-index:100}h1{font-size:2rem;font-weight:700;margin-bottom:1rem;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.toolbar{display:flex;flex-wrap:wrap;gap:0.75rem;align-items:center}button,.file-input-wrapper{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:0.65rem 1.25rem;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.9rem;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(102,126,234,0.3)}button:hover:not(:disabled),.file-input-wrapper:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,0.5)}button:active:not(:disabled){transform:translateY(0)}button:disabled{opacity:0.5;cursor:not-allowed}.file-input-wrapper{display:inline-block;position:relative}.file-input-wrapper input[type="file"]{position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer}#scramble{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%)}#save{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)}#strip-all{background:linear-gradient(135deg,#fa709a 0%,#fee140 100%)}#compare{background:linear-gradient(135deg,#a8edea 0%,#fed6e3 100%);color:#333}main{max-width:1800px;margin:2rem auto;padding:0 2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem}@media(max-width:1200px){main{grid-template-columns:1fr}}.panel{background:rgba(30,30,50,0.6);backdrop-filter:blur(10px);border-radius:16px;padding:1.5rem;border:1px solid rgba(255,255,255,0.1);box-shadow:0 8px 32px rgba(0,0,0,0.3)}.panel h2{font-size:1.3rem;margin-bottom:1rem;color:#a8b2d1;display:flex;align-items:center;gap:0.5rem}#preview{width:100%;height:auto;max-height:500px;object-fit:contain;border-radius:12px;background:rgba(0,0,0,0.3);display:block}.image-info{margin-top:1rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.75rem}.info-item{background:rgba(0,0,0,0.3);padding:0.75rem;border-radius:8px;border:1px solid rgba(255,255,255,0.1)}.info-label{font-size:0.75rem;color:#888;text-transform:uppercase;letter-spacing:0.5px}.info-value{font-size:1rem;font-weight:600;color:#a8b2d1;margin-top:0.25rem}.placeholder{width:100%;height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.3);border-radius:12px;color:#666;font-size:1.1rem;border:2px dashed rgba(102,126,234,0.3);transition:all 0.3s ease}.placeholder.drag-over{border-color:#667eea;background:rgba(102,126,234,0.1)}.placeholder-icon{font-size:4rem;margin-bottom:1rem}.search-box{margin-bottom:1rem;position:relative}.search-box input{width:100%;padding:0.75rem 1rem 0.75rem 2.5rem;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.3);color:#e0e0e0;font-size:0.9rem}.search-box::before{content:"üîç";position:absolute;left:0.75rem;top:50%;transform:translateY(-50%);font-size:1rem}#metadata-form{max-height:450px;overflow-y:auto;padding-right:0.5rem}#metadata-form::-webkit-scrollbar,#json-view::-webkit-scrollbar{width:8px}#metadata-form::-webkit-scrollbar-track,#json-view::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:4px}#metadata-form::-webkit-scrollbar-thumb,#json-view::-webkit-scrollbar-thumb{background:rgba(102,126,234,0.5);border-radius:4px}.section-title{font-size:0.9rem;font-weight:700;color:#667eea;margin:1rem 0 0.5rem;padding-bottom:0.25rem;border-bottom:1px solid rgba(102,126,234,0.3);text-transform:uppercase;letter-spacing:0.5px}.section-title:first-child{margin-top:0}.mini-btn{background:rgba(102,126,234,0.2);border:1px solid rgba(102,126,234,0.3);color:#667eea;padding:0.25rem 0.5rem;border-radius:4px;font-size:0.75rem;cursor:pointer;transition:all 0.2s ease}.mini-btn:hover{background:rgba(102,126,234,0.3)}.entry{margin-bottom:1rem}.entry label{display:block;font-size:0.85rem;color:#a8b2d1;margin-bottom:0.35rem;font-weight:500}.entry input{width:100%;padding:0.6rem;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.3);color:#e0e0e0;font-size:0.9rem;transition:all 0.2s ease}.entry input:focus{outline:none;border-color:#667eea;background:rgba(0,0,0,0.4);box-shadow:0 0 0 3px rgba(102,126,234,0.1)}#json-view{background:rgba(0,0,0,0.4);padding:1rem;border-radius:8px;max-height:300px;overflow-y:auto;font-family:'Courier New',monospace;font-size:0.85rem;color:#a8e6cf;border:1px solid rgba(255,255,255,0.1)}.json-actions{display:flex;gap:0.5rem;margin-bottom:0.5rem}.map-panel{grid-column:1/-1}#map{height:400px;border-radius:12px;border:1px solid rgba(255,255,255,0.1)}.map-controls{display:flex;gap:0.5rem;margin-top:1rem;flex-wrap:wrap}.map-controls input{flex:1;min-width:200px;padding:0.5rem;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.3);color:#e0e0e0}.empty-state{text-align:center;padding:2rem;color:#666}.empty-state-icon{font-size:3rem;margin-bottom:1rem}.info-badge{display:inline-block;background:rgba(102,126,234,0.2);color:#667eea;padding:0.25rem 0.75rem;border-radius:12px;font-size:0.8rem;font-weight:600;margin-left:0.5rem}.toast{position:fixed;bottom:2rem;right:2rem;background:rgba(30,30,50,0.95);backdrop-filter:blur(10px);color:white;padding:1rem 1.5rem;border-radius:8px;border:1px solid rgba(102,126,234,0.5);box-shadow:0 8px 32px rgba(0,0,0,0.5);transform:translateY(150%);transition:transform 0.3s ease;z-index:1000;max-width:300px}.toast.show{transform:translateY(0)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);z-index:1000;align-items:center;justify-content:center}.modal.show{display:flex}.modal-content{background:rgba(30,30,50,0.95);border-radius:16px;padding:2rem;max-width:90%;max-height:90%;overflow-y:auto;border:1px solid rgba(255,255,255,0.1);box-shadow:0 8px 32px rgba(0,0,0,0.5)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-close{background:none;border:none;color:#999;font-size:1.5rem;cursor:pointer;padding:0;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all 0.2s ease}.modal-close:hover{background:rgba(255,255,255,0.1);color:white}.compare-grid{display:grid;grid-template-columns:1fr 1fr;gap:2rem}@media(max-width:768px){.compare-grid{grid-template-columns:1fr}}.compare-item h4{color:#667eea;margin-bottom:0.5rem}.compare-item pre{background:rgba(0,0,0,0.3);padding:1rem;border-radius:8px;font-size:0.8rem;max-height:400px;overflow-y:auto}.batch-controls{display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:1rem}.batch-counter{color:#a8b2d1;padding:0.65rem 1.25rem;background:rgba(0,0,0,0.3);border-radius:8px}
  </style>
</head>
<body>
  <header>
    <h1>üì∑ Photo Metadata Editor Pro</h1>
    <div class="toolbar">
      <div class="file-input-wrapper">üìÅ Load<input type="file" id="main-upload" accept="image/jpeg,image/jpg"></div>
      <div class="file-input-wrapper">üìÇ Batch<input type="file" id="batch-upload" accept="image/jpeg,image/jpg" multiple></div>
      <div class="file-input-wrapper">üîÑ Copy Meta<input type="file" id="meta-upload" accept="image/jpeg,image/jpg"></div>
      <button id="strip-all" disabled>üóëÔ∏è Strip All</button>
      <button id="scramble" disabled>üé≤ Randomize</button>
      <button id="compare" disabled>‚öñÔ∏è Compare</button>
      <button id="save" disabled>üíæ Save</button>
    </div>
  </header>
  <main>
    <section class="panel">
      <h2>üñºÔ∏è Image</h2>
      <div id="preview-container"><div class="placeholder"><div class="placeholder-icon">üì∏</div><p>Drop image or click Load</p></div></div>
      <div class="image-info" id="image-info" style="display:none">
        <div class="info-item"><div class="info-label">Size</div><div class="info-value" id="dimensions">-</div></div>
        <div class="info-item"><div class="info-label">File</div><div class="info-value" id="filesize">-</div></div>
        <div class="info-item"><div class="info-label">Format</div><div class="info-value">JPEG</div></div>
        <div class="info-item"><div class="info-label">Camera</div><div class="info-value" id="camera">-</div></div>
      </div>
      <div class="batch-controls" id="batch-controls" style="display:none">
        <button id="prev-batch" class="mini-btn">‚¨ÖÔ∏è Prev</button>
        <span class="batch-counter" id="batch-counter">1/1</span>
        <button id="next-batch" class="mini-btn">‚û°Ô∏è Next</button>
        <button id="save-all-batch" class="mini-btn">üíæ Save All</button>
      </div>
    </section>
    <section class="panel">
      <h2>üß¨ Metadata</h2>
      <div class="search-box"><input type="text" id="search-meta" placeholder="Search..."></div>
      <div id="metadata-form"><div class="empty-state"><div class="empty-state-icon">üìã</div><p>No metadata</p></div></div>
      <h2 style="margin-top:1.5rem">üìÑ JSON</h2>
      <div class="json-actions">
        <button class="mini-btn" id="copy-json">üìã Copy</button>
        <button class="mini-btn" id="download-json">‚¨áÔ∏è Download</button>
      </div>
      <pre id="json-view">{}</pre>
    </section>
    <section class="panel map-panel">
      <h2>üó∫Ô∏è GPS <span class="info-badge" id="gps-status">No GPS</span></h2>
      <div id="map"></div>
      <div class="map-controls">
        <button class="mini-btn" id="center-map" disabled>üéØ Center</button>
        <button class="mini-btn" id="clear-gps" disabled>üóëÔ∏è Clear</button>
        <button class="mini-btn" id="add-gps" disabled>‚ûï Add</button>
        <input type="text" id="search-location" placeholder="Search location...">
        <button class="mini-btn" id="search-location-btn">üîç</button>
      </div>
    </section>
  </main>
  <div id="toast" class="toast"></div>
  <div id="compare-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header"><h2>‚öñÔ∏è Compare</h2><button class="modal-close">√ó</button></div>
      <div class="compare-grid" id="compare-content"></div>
    </div>
  </div>
  <script>
const previewContainer=document.getElementById("preview-container"),mainUpload=document.getElementById("main-upload"),batchUpload=document.getElementById("batch-upload"),metaUpload=document.getElementById("meta-upload"),form=document.getElementById("metadata-form"),jsonView=document.getElementById("json-view"),scrambleBtn=document.getElementById("scramble"),saveBtn=document.getElementById("save"),stripAllBtn=document.getElementById("strip-all"),compareBtn=document.getElementById("compare"),gpsStatus=document.getElementById("gps-status"),searchMeta=document.getElementById("search-meta"),toast=document.getElementById("toast"),compareModal=document.getElementById("compare-modal");let originalDataURL=null,originalExifData=null,exifData=null,currentFile=null,mapInitialized=!1,mapInstance=null,mapMarker=null,batchFiles=[],currentBatchIndex=0;function formatBytes(e){if(0===e)return"0 B";const t=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,a)).toFixed(1)+" "+t[a]}function showToast(e,t=3e3){toast.textContent=e,toast.classList.add("show"),setTimeout(()=>toast.classList.remove("show"),t)}const placeholder=document.querySelector(".placeholder");function loadImage(e,t=!1){currentFile=e;const a=new FileReader;a.onload=function(a){const n=a.target.result;if(!t){originalDataURL=n;const t=new Image;t.onload=()=>{document.getElementById("dimensions").textContent=`${t.width}√ó${t.height}`},t.id="preview",t.src=n,previewContainer.innerHTML="",previewContainer.appendChild(t),document.getElementById("filesize").textContent=formatBytes(e.size),document.getElementById("image-info").style.display="grid"}try{const e=piexif.load(n);exifData=e,originalExifData=JSON.parse(JSON.stringify(e)),exifData.GPS||(exifData.GPS={});const a=exifData["0th"]?.[piexif.ImageIFD.Make]||"",r=exifData["0th"]?.[piexif.ImageIFD.Model]||"";document.getElementById("camera").textContent=a&&r?`${a} ${r}`:"Unknown",scrambleBtn.disabled=!1,saveBtn.disabled=!1,stripAllBtn.disabled=!1,compareBtn.disabled=!1,document.getElementById("add-gps").disabled=!1,showToast(t?"‚úÖ Meta replaced":"‚úÖ Loaded")}catch(e){exifData={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},originalExifData=JSON.parse(JSON.stringify(exifData)),document.getElementById("camera").textContent="None",scrambleBtn.disabled=!1,saveBtn.disabled=!1,stripAllBtn.disabled=!1,compareBtn.disabled=!1,document.getElementById("add-gps").disabled=!1,showToast("‚ö†Ô∏è No EXIF")}renderForm(),updateMapFromExif(exifData),jsonView.textContent=JSON.stringify(exifData,null,2)},a.readAsDataURL(e)}function renderForm(){const e=searchMeta.value.toLowerCase();form.innerHTML="";["0th","Exif","GPS","Interop"].forEach(t=>{if(!exifData[t]||"object"!=typeof exifData[t])return;const a=Object.entries(exifData[t]).filter(([e,t])=>null!=t&&"thumbnail"!==e);if(0===a.length)return;const n=document.createElement("div");n.className="section-title",n.textContent=t;let r=!1;const i=document.createElement("div");a.forEach(([a,n])=>{const o=piexif.TAGS[t]?.[a]?.name||`Tag ${a}`;if(e&&!o.toLowerCase().includes(e)&&!String(n).toLowerCase().includes(e))return;r=!0;const s=document.createElement("div");s.className="entry";const l=document.createElement("label");l.textContent=o;const d=document.createElement("input");d.dataset.section=t,d.dataset.tag=a,Array.isArray(n)?d.value=n.join(", "):"object"==typeof n?d.value=JSON.stringify(n):d.value=n,d.addEventListener("input",()=>{updateExifFromForm(),jsonView.textContent=JSON.stringify(exifData,null,2)}),s.appendChild(l),s.appendChild(d),i.appendChild(s)}),r&&(form.appendChild(n),form.appendChild(i))}),"" ===form.innerHTML&&(form.innerHTML='<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No metadata</p></div>')}function updateExifFromForm(){form.querySelectorAll("input").forEach(e=>{const t=e.dataset.section,a=e.dataset.tag,n=e.value.trim();if(!n)return;let r;if(n.includes(",")){const e=n.split(",").map(e=>e.trim());r=e.map(e=>{const t=parseFloat(e);return isNaN(t)?e:t})}else r=isNaN(n)||""===n?n:parseFloat(n);exifData[t]||(exifData[t]={}),exifData[t][a]=r})}function scrambleMetadata(){if(!exifData)return;const e=(new Date).toISOString().replace(/[T\-:\.Z]/g," ").trim().substring(0,19),t=()=>[Math.floor(90*Math.random()),Math.floor(60*Math.random()),Math.floor(60*Math.random())],a=()=>Math.random().toString(36).substring(2,10).toUpperCase();exifData["0th"]||(exifData["0th"]={}),exifData["0th"][piexif.ImageIFD.Make]=`Brand${a()}`,exifData["0th"][piexif.ImageIFD.Model]=`Model${a()}`,exifData["0th"][piexif.ImageIFD.Software]="PhotoEditor Pro",exifData.Exif||(exifData.Exif={}),exifData.Exif[piexif.ExifIFD.DateTimeOriginal]=e,exifData.Exif[piexif.ExifIFD.LensMake]=`Lens${a()}`,exifData.GPS||(exifData.GPS={});const n=t(),r=t();exifData.GPS[piexif.GPSIFD.GPSLatitude]=n,exifData.GPS[piexif.GPSIFD.GPSLongitude]=r,exifData.GPS[piexif.GPSIFD.GPSLatitudeRef]=Math.random()>.5?"N":"S",exifData.GPS[piexif.GPSIFD.GPSLongitudeRef]=Math.random()>.5?"E":"W",renderForm(),updateMapFromExif(exifData),jsonView.textContent=JSON.stringify(exifData,null,2),showToast("üé≤ Randomized")}function stripAllMetadata(){exifData&&(exifData={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},renderForm(),updateMapFromExif(exifData),jsonView.textContent=JSON.stringify(exifData,null,2),showToast("üóëÔ∏è Stripped"))}function saveImage(){if(!originalDataURL||!exifData)return;try{updateExifFromForm();const e=piexif.dump(exifData),t=piexif.insert(e,originalDataURL),a=document.createElement("a");a.href=t,a.download=`photo_${Date.now()}.jpg`,document.body.appendChild(a),a.click(),document.body.removeChild(a),showToast("üíæ Saved")}catch(e){showToast("‚ùå Error"),console.error(e)}}function updateMapFromExif(e){const t=e?.GPS?.[piexif.GPSIFD.GPSLatitude],a=e?.GPS?.[piexif.GPSIFD.GPSLongitude],n=e?.GPS?.[piexif.GPSIFD.GPSLatitudeRef],r=e?.GPS?.[piexif.GPSIFD.GPSLongitudeRef];if(!t||!a||!Array.isArray(t)||!Array.isArray(a))return gpsStatus.textContent="No GPS",gpsStatus.style.background="rgba(255,87,87,0.2)",gpsStatus.style.color="#ff5757",void(document.getElementById("center-map").disabled=!0);const i=(e,t)=>{let a=e[0]+e[1]/60+e[2]/3600;return"S"!==t&&"W"!==t||(a*=-1),a},o=e=>{const t=Math.floor(Math.abs(e)),a=(Math.abs(e)-t)*60,n=Math.floor(a),r=Math.round(100*(a-n)*60)/100;return[t,n,r]},s=i(t,n),l=i(a,r);gpsStatus.textContent=`${s.toFixed(4)}¬∞, ${l.toFixed(4)}¬∞`,gpsStatus.style.background="rgba(102,126,234,0.2)",gpsStatus.style.color="#667eea",document.getElementById("center-map").disabled=!1,document.getElementById("clear-gps").disabled=!1,mapInitialized||(mapInstance=L.map("map").setView([s,l],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(mapInstance),mapInitialized=!0),mapMarker&&mapInstance.removeLayer(mapMarker),mapMarker=L.marker([s,l],{draggable:!0}).addTo(mapInstance).bindPopup("üìç Drag me").openPopup(),mapMarker.on("dragend",()=>{const{lat:e,lng:t}=mapMarker.getLatLng();exifData.GPS||(exifData.GPS={}),exifData.GPS[piexif.GPSIFD.GPSLatitude]=o(e),exifData.GPS[piexif.GPSIFD.GPSLatitudeRef]=e>=0?"N":"S",exifData.GPS[piexif.GPSIFD.GPSLongitude]=o(t),exifData.GPS[piexif.GPSIFD.GPSLongitudeRef]=t>=0?"E":"W",gpsStatus.textContent=`${e.toFixed(4)}¬∞, ${t.toFixed(4)}¬∞`,renderForm(),jsonView.textContent=JSON.stringify(exifData,null,2)}),mapInstance.setView([s,l],13)}function loadBatchImage(e){currentBatchIndex=e,loadImage(batchFiles[e]),document.getElementById("batch-counter").textContent=`${e+1}/${batchFiles.length}`,document.getElementById("prev-batch").disabled=0===e,document.getElementById("next-batch").disabled=e===batchFiles.length-1}previewContainer.addEventListener("dragover",e=>{e.preventDefault(),placeholder&&placeholder.classList.add("drag-over")}),previewContainer.addEventListener("dragleave",()=>{placeholder&&placeholder.classList.remove("drag-over")}),previewContainer.addEventListener("drop",e=>{e.preventDefault(),placeholder&&placeholder.classList.remove("drag-over"),e.dataTransfer.files.length&&loadImage(e.dataTransfer.files[0])}),searchMeta.addEventListener("input",renderForm),mainUpload.addEventListener("change",e=>{e.target.files.length&&(batchFiles=[],document.getElementById("batch-controls").style.display="none",loadImage(e.target.files[0]))}),batchUpload.addEventListener("change",e=>{if(e.target.files.length){batchFiles=Array.from(e.target.files),loadBatchImage(0),document.getElementById("batch-controls").style.display="flex"}}),document.getElementById("prev-batch").addEventListener("click",()=>{currentBatchIndex>0&&loadBatchImage(currentBatchIndex-1)}),document.getElementById("next-batch").addEventListener("click",()=>{currentBatchIndex<batchFiles.length-1&&loadBatchImage(currentBatchIndex+1)}),document.getElementById("save-all-batch").addEventListener("click",()=>{batchFiles.forEach(e=>loadImage(e)),showToast(`üíæ Saved ${batchFiles.length} files`)}),metaUpload.addEventListener("change",e=>{e.target.files.length&&loadImage(e.target.files[0],!0)}),scrambleBtn.addEventListener("click",scrambleMetadata),stripAllBtn.addEventListener("click",stripAllMetadata),saveBtn.addEventListener("click",saveImage),compareBtn.addEventListener("click",()=>{if(!originalExifData||!exifData)return;const e=document.getElementById("compare-content");e.innerHTML=`<div class="compare-item"><h4>Original</h4><pre>${JSON.stringify(originalExifData,null,2)}</pre></div><div class="compare-item"><h4>Current</h4><pre>${JSON.stringify(exifData,null,2)}</pre></div>`,compareModal.classList.add("show")}),document.querySelector(".modal-close").addEventListener("click",()=>{compareModal.classList.remove("show")}),compareModal.addEventListener("click",e=>{e.target===compareModal&&compareModal.classList.remove("show")}),document.getElementById("copy-json").addEventListener("click",()=>{navigator.clipboard.writeText(JSON.stringify(exifData,null,2)).then(()=>showToast("üìã Copied"))}),document.getElementById("download-json").addEventListener("click",()=>{const e=new Blob([JSON.stringify(exifData,null,2)],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="metadata.json",t.click(),showToast("‚¨áÔ∏è Downloaded")}),document.getElementById("center-map").addEventListener("click",()=>{if(mapMarker){const e=mapMarker.getLatLng();mapInstance.setView([e.lat,e.lng],13),showToast("üéØ Centered")}}),document.getElementById("clear-gps").addEventListener("click",()=>{exifData&&exifData.GPS&&(exifData.GPS={},mapMarker&&(mapInstance.removeLayer(mapMarker),mapMarker=null),gpsStatus.textContent="No GPS",gpsStatus.style.background="rgba(255,87,87,0.2)",gpsStatus.style.color="#ff5757",document.getElementById("center-map").disabled=!0,document.getElementById("clear-gps").disabled=!0,renderForm(),jsonView.textContent=JSON.stringify(exifData,null,2),showToast("üóëÔ∏è GPS cleared"))}),document.getElementById("add-gps").addEventListener("click",()=>{const e=mapInstance.getCenter(),t=e=>{const t=Math.floor(Math.abs(e)),a=(Math.abs(e)-t)*60,n=Math.floor(a),r=Math.round(100*(a-n)*60)/100;return[t,n,r]};exifData.GPS||(exifData.GPS={}),exifData.GPS[piexif.GPSIFD.GPSLatitude]=t(e.lat),exifData.GPS[piexif.GPSIFD.GPSLatitudeRef]=e.lat>=0?"N":"S",exifData.GPS[piexif.GPSIFD.GPSLongitude]=t(e.lng),exifData.GPS[piexif.GPSIFD.GPSLongitudeRef]=e.lng>=0?"E":"W",updateMapFromExif(exifData),renderForm(),jsonView.textContent=JSON.stringify(exifData,null,2),showToast("‚ûï GPS added")}),document.getElementById("search-location-btn").addEventListener("click",async()=>{const e=document.getElementById("search-location").value.trim();if(!e)return void showToast("‚ö†Ô∏è Enter location");try{const t=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}`);if(!t.ok)return void showToast("‚ùå Search failed");const a=await t.json();if(0===a.length)return void showToast("‚ùå Not found");const n=parseFloat(a[0].lat),r=parseFloat(a[0].lon);mapInstance.setView([n,r],13),showToast(`‚úÖ Found: ${a[0].display_name.split(",")[0]}`)}catch(e){showToast("‚ùå Error"),console.error(e)}}),mapInitialized||(mapInstance=L.map("map").setView([40,-95],4),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(mapInstance),mapInitialized=!0)